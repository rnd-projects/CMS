<% include ../partials/header.ejs %>
<script src="https://cdn.ckeditor.com/4.6.2/standard/ckeditor.js"></script>
<style>
    #announce-drop {
        min-width: 11em;
    }
    .new-dep {
        min-width: 8em!important;
    }
    #modal-preview {
        margin: 0!important;
    }
    .footer {
        margin-top: 5px!important;
    }
    .submit-div {
        bottom: 50px;
        margin-right: 95px;
    }
    .img-icon {
        width: 135px;
        height: 135px;
    }
    .ui.label {
        margin-bottom: 5px;
    }
    ui.label:first-child {
        margin-left: 2px
    }
</style>

    <div class="ui container body segment" style="margin-bottom: 50px; padding-top: 15px;">
        <!--Header -->
        <h2 class="ui icon header center aligned">
            <i class="announcement icon"></i>
            <div class="content">
                Announcement Form
                <div class="sub header">Use the Below Form to Submit a New Announcement</div>
            </div>
        </h2>
        <!--Form Starts here -->
        <div class="ui segment">
            <form class="ui form" action="/announcements" method="post">
                <div class="fields">
                    <div class="field new-pic">
                        <img class="item img-icon" src="/images/departments/Default.svg" alt="Default Icon">
                    </div>
                    <div class="fifteen wide field">
                        <div class="fields">
                            <div class="required twelve wide field">
                                <label>Title</label>
                                <input type="text" placeholder="Title" class="new-title" name="announcement[title]">
                            </div>
                            <!--Department Dropdown List -->
                            <div class="required four wide field">
                                <label>Department</label>
                                <div class="field">
                                    <select class="ui search selection dropdown new-dep" name="announcement[department]">
                                        <option value="">Department</option>
                                        <% departments.forEach(function(dep){ %>
                                        <option class="new-department" value="<%= dep._id%>" data-support="<%= dep.picture%>"><%= dep.name%></option>
                                        <% })%>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="fields">
                            <!-- duration dropdown list -->
                            <div class="four wide field">
                                <label>Duration</label>
                                <input type="number" name="announcement[archiveAfter]" >
                            </div>
                            <div class="required twelve wide field">
                                <!-- Tag drowpdown section -->
                                <label>Tag</label>
                                <div class="field">
                                    <select class="ui search selection multiple fluid dropdown new-tags" name="announcement[tags]">
                                        <option value="">Tag</option>
                                        <% tags.forEach(function(tag){ %>
                                        <option  value="<%= tag._id%>" data-tagcolor="<%= tag.color%>"><%= tag.name%></option>
                                        <% })%>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--WYSIWYG Editor CKeditor-->
                <div class="required field">
                    <label>Content</label>
                    <textarea name="announcement[body]" id="editor1" rows="10" cols="80">
                            Enter Your description Here
                        </textarea>
                    <script>
                        // Replace the <textarea id="editor1"> with a CKEditor
                        CKEDITOR.replace( 'editor1', {customConfig: '/javascripts/config.js'});
                    </script>
                </div>
                <!--submission section -->
                <footer class="ui grid footer">
                    <div class="two column row">
                        <div class="ui checkbox left floated">
                            <input type="checkbox" tabindex="0"  name="new-announcement" id="new-announcement">
                            <label>Add New Announcement</label>
                        </div>
                        <div class="right floated right aligned column">
                            <button class="ui button" type="submit">Submit</button>
                        </div>
                    </div>
                </footer>
            </form>
            <div class="ui grid">
                <div class="row">
                    <div class="right aligned column submit-div">
                    <button id="preview" class="ui button">Preview</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Set Modal -->
    <div class="ui modal">
        <i class="close icon"></i>
        <div class="ui raised very padded text segment" id="modal-preview">
            <div class="ui items">
                <div class="item">
                    <a class="ui small image">
                        <img class="item article-img" src="/images/departments/Default.svg" alt="Department Icon">
                        <h5 class="article-date"></h5>
                        <h4>Author</h4>
                        <p><%= currentUser.name%></p>
                        <h4>Tags</h4>
                        <div class = "article-tags"></div>
                    </a>
                    <div class="content">
                        <a class="header article-title"></a>
                        <div class="description">
                            <p class="article-text"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
    var today = new Date(Date.now());

    $('.ui.selection.dropdown')
        .dropdown()
    ;
    //populates modal on Preview click
    $('#preview').click(function(){
        var tagList = ($('.new-tags a'))
        $('.article-date').text(today.toDateString());
        $('.article-title').text($('.new-title').val());
        $('.article-text').html(CKEDITOR.instances.editor1.getData());
        $('.article-img').attr('src',$('.new-dep option:selected').data("support"));

        //Clear Tags and re-populate
        $('.article-tags').empty();
        for (var i=0; i<tagList.length;i++){
            $('.article-tags').append('<p class="small ui' + 'red' + ' basic label">' + tagList[i].text + '</p>');
        }
    })
    //opens modal on preview click
    $('.ui.modal')
        .modal('attach events', '#preview', 'show')
    ;
</script>

<% include ../partials/header.ejs %>
